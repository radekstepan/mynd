(function(){var o={},JST={};JST["actions.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<a class="btn btn-small '),this.disabled&&__out.push("disabled"),__out.push(' view">View</a>\n<a class="btn btn-small '),this.disabled&&__out.push("disabled"),__out.push(' export">Download</a>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["error.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="alert alert-block">\n    <h4 class="alert-heading">'),__out.push(__sanitize(this.title)),__out.push(" for "),__out.push(__sanitize(this.name)),__out.push("</h4>\n    <p>"),__out.push(this.text),__out.push("</p>\n</div>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["extra.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var v,_i,_len,_ref;__out.push('<div class="group" style="display:inline-block;margin:0 5px 10px 0;float:left">\n    <label>'),__out.push(__sanitize(this.label)),__out.push("</label>\n    ");if(this.possible.length>1){__out.push('\n        <select name="'),__out.push(__sanitize(this.label)),__out.push('" class="span2">\n            '),_ref=this.possible;for(_i=0,_len=_ref.length;_i<_len;_i++)v=_ref[_i],__out.push('\n                <option value="'),__out.push(__sanitize(v)),__out.push('" '),this.selected===v&&__out.push(__sanitize('selected="selected"')),__out.push(">\n                    "),__out.push(__sanitize(v)),__out.push("\n                </option>\n            ");__out.push("\n        </select>\n    ")}else __out.push("\n        "),__out.push(__sanitize(this.possible[0])),__out.push("\n    ");__out.push('\n</div>\n<div style="clear:both"></div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["invalidjsonkey.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<li style="vertical-align:bottom">\n    <span style="display:inline-block" class="label label-important">'),__out.push(__sanitize(this.key)),__out.push("</span> is "),__out.push(__sanitize(this.actual)),__out.push("; was expecting "),__out.push(__sanitize(this.expected)),__out.push("\n</li>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["loading.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="loading" style="background:rgba(255,255,255,0.9);position:absolute;top:0;left:0;height:100%;width:100%;text-align:center;">\n    <p style="padding-top:50%;font-weight:bold;">Loading &hellip;</p>\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["noresults.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="alert alert-info">\n    <p>The Widget has no results.</p>\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["enrichment.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="header">\n    <h3>'),this.title&&__out.push(__sanitize(this.title)),__out.push("</h3>\n    <p>"),this.description&&__out.push(this.description),__out.push("</p>\n    "),this.notAnalysed&&(__out.push("\n        <p>Number of Genes in this list not analysed in this widget: <a>"),__out.push(__sanitize(this.notAnalysed)),__out.push("</a></p>\n    ")),__out.push('\n\n    <div class="form">\n        <!-- enrichment.form.eco -->\n    </div>\n\n    <div class="actions" style="padding:10px 0">\n        <!-- actions.eco -->\n    </div>\n</div>\n<div class="content">\n    <!-- enrichment.table.eco -->\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["enrichment.form.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var correction,p,_i,_j,_len,_len1,_ref,_ref1;__out.push('<form style="margin:0">\n    <div class="group" style="display:inline-block;margin-right:5px;float:left">\n        <label>Test Correction</label>\n        <select name="errorCorrection" class="span2">\n            '),_ref=this.errorCorrections;for(_i=0,_len=_ref.length;_i<_len;_i++)correction=_ref[_i],__out.push('\n                <option value="'),__out.push(__sanitize(correction)),__out.push('" '),this.options.errorCorrection===correction&&__out.push(__sanitize('selected="selected"')),__out.push(">\n                    "),__out.push(__sanitize(correction)),__out.push("\n            </option>\n            ");__out.push('\n        </select>\n    </div>\n\n    <div class="group" style="display:inline-block;margin-right:5px;float:left">\n        <label>Max p-value</label>\n        <select name="pValue" class="span2">\n            '),_ref1=this.pValues;for(_j=0,_len1=_ref1.length;_j<_len1;_j++)p=_ref1[_j],__out.push('\n                <option value="'),__out.push(__sanitize(p)),__out.push('" '),this.options.pValue===p&&__out.push(__sanitize('selected="selected"')),__out.push(">\n                    "),__out.push(__sanitize(p)),__out.push("\n                </option>\n            ");__out.push('\n        </select>\n    </div>\n</form>\n<div style="clear:both"></div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["enrichment.row.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<td class="check"><input type="checkbox" '),this.row.selected&&__out.push('checked="checked"'),__out.push(' /></td>\n<td class="description">\n    '),__out.push(__sanitize(this.row.description)),__out.push("\n    "),this.row.externalLink&&(__out.push('\n        [<a href="'),__out.push(this.row.externalLink),__out.push('" target="_blank">Link</a>]\n    ')),__out.push('\n</td>\n<td class="pValue">'),__out.push(__sanitize(this.row["p-value"].toPrecision(5))),__out.push('</td>\n<td class="matches">\n    <a class="count" style="cursor:pointer">'),__out.push(__sanitize(this.row.matches)),__out.push("</a>\n</td>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["enrichment.table.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<!-- actual fixed head -->\n<div class="head" style="display:table">\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;"><input type="checkbox" class="check" /></div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">'),__out.push(__sanitize(this.label)),__out.push('</div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">p-Value</div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">Matches</div>\n    <div style="clear:both"></div>\n</div>\n<div class="wrapper" style="overflow:auto;overflow-x:hidden">\n    <table class="table table-striped">\n        <!-- head for proper cell width -->\n        <thead style="visibility:hidden">\n            <tr>\n                <th></th>\n                <th>'),__out.push(__sanitize(this.label)),__out.push("</th>\n                <th>p-Value</th>\n                <th>Matches</th>\n            </tr>\n        </thead>\n        <tbody>\n            <!-- loop enrichment.row.eco -->\n        </tbody>\n    </table>\n</div>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["chart.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="header">\n    <h3>'),this.title&&__out.push(__sanitize(this.title)),__out.push('</h3>\n    <p style="margin:0">'),this.description&&__out.push(this.description),__out.push("</p>\n    "),this.notAnalysed&&(__out.push('\n        <p style="margin:10px 0 0 0">Number of Genes in this list not analysed in this widget: <a>'),__out.push(__sanitize(this.notAnalysed)),__out.push("</a></p>\n    ")),__out.push('\n\n    <div class="form">\n        <form style="margin:0;padding:10px 0 0 0">\n            <!-- extra.eco -->\n        </form>\n    </div>\n</div>\n<div class="content">\n    <div class="settings"></div>\n    <div class="legend"></div>\n    <div class="chart"></div>\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["popover.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="popover" style="position:absolute;top:5px;right:0;z-index:1;display:block">\n    <div class="popover-inner" style="'),__out.push(__sanitize(this.style)),__out.push('">\n        <a style="cursor:pointer;margin:2px 5px 0 0" class="close">Ã—</a>\n        <h3 class="popover-title">\n            '),__out.push(__sanitize(this.description.slice(0,this.descriptionLimit-1+1||9e9))),__out.push("\n            "),this.description.length>this.descriptionLimit&&__out.push("&hellip;"),__out.push('\n        </h3>\n        <div class="popover-content">\n            <div class="values">\n                <!-- popover.values.eco -->\n            </div>\n            <div style="margin-top:10px">\n                <a class="btn btn-small btn-primary results">View results</a>\n                <a class="btn btn-small list disabled">Create list</a>\n            </div>\n        </div>\n    </div>\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["popover.values.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var object,_i,_len,_ref;__out.push("<h4>"),__out.push(__sanitize(this.values.length)),__out.push(" "),__out.push(__sanitize(this.type)),this.values.length!==1&&__out.push(__sanitize("s")),__out.push(":</h4>\n\n"),_ref=this.values.slice(0,this.valuesLimit-1+1||9e9);for(_i=0,_len=_ref.length;_i<_len;_i++)object=_ref[_i],__out.push('\n    <a href="#" class="match">'),__out.push(__sanitize(object)),__out.push("</a>\n");__out.push("\n"),this.values.length>this.valuesLimit&&__out.push("&hellip;")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["table.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){__out.push('<div class="header">\n    <h3>'),this.title&&__out.push(__sanitize(this.title)),__out.push("</h3>\n    <p>"),this.description&&__out.push(this.description),__out.push("</p>\n    "),this.notAnalysed&&(__out.push("\n        <p>Number of Genes in this list not analysed in this widget: <a>"),__out.push(__sanitize(this.notAnalysed)),__out.push("</a></p>\n    ")),__out.push('\n\n    <div class="actions" style="padding:10px 0">\n        <!-- actions.eco -->\n    </div>\n</div>\n<div class="content">\n    <!-- table.table.eco -->\n</div>')}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["table.row.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var column,_i,_len,_ref;__out.push('<td class="check"><input type="checkbox" '),this.row.selected&&__out.push('checked="checked"'),__out.push(" /></td>\n"),_ref=this.row.descriptions;for(_i=0,_len=_ref.length;_i<_len;_i++)column=_ref[_i],__out.push("\n    <td>"),__out.push(__sanitize(column)),__out.push("</td>\n");__out.push("\n<td>"),__out.push(__sanitize(this.row.matches)),__out.push("</td>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")},JST["table.table.eco"]=function(__obj){__obj||(__obj={});var __out=[],__capture=function(callback){var out=__out,result;return __out=[],callback.call(this),result=__out.join(""),__out=out,__safe(result)},__sanitize=function(value){return value&&value.ecoSafe?value:typeof value!="undefined"&&value!=null?__escape(value):""},__safe,__objSafe=__obj.safe,__escape=__obj.escape;return __safe=__obj.safe=function(value){if(value&&value.ecoSafe)return value;if(typeof value=="undefined"||value==null)value="";var result=new String(value);return result.ecoSafe=!0,result},__escape||(__escape=__obj.escape=function(value){return(""+value).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var column,_i,_j,_len,_len1,_ref,_ref1;__out.push('<!-- actual fixed head -->\n<div class="head" style="display:table">\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;"><input type="checkbox" class="check" /></div>\n    '),_ref=this.columns;for(_i=0,_len=_ref.length;_i<_len;_i++)column=_ref[_i],__out.push('\n        <div style="font-weight:bold;display:table-cell;padding:0 8px;">'),__out.push(__sanitize(column)),__out.push("</div>\n    ");__out.push('\n    <div style="clear:both"></div>\n</div>\n<div class="wrapper" style="overflow:auto;overflow-x:hidden">\n    <table class="table table-striped">\n        <!-- head for proper cell width -->\n        <thead style="visibility:hidden">\n            <tr>\n                <th></th>\n                '),_ref1=this.columns;for(_j=0,_len1=_ref1.length;_j<_len1;_j++)column=_ref1[_j],__out.push("\n                    <th>"),__out.push(__sanitize(column)),__out.push("</th>\n                ");__out.push("\n            </tr>\n        </thead>\n        <tbody>\n            <!-- loop table.row.eco -->\n        </tbody>\n    </table>\n</div>")}).call(this)}.call(__obj),__obj.safe=__objSafe,__obj.escape=__escape,__out.join("")};var Chart;Chart={toPNG:function(svgEl,width,height){var canvas;return canvas=$("<canvas/>",{style:"image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast"}).attr("width",width).attr("height",height),canvg(canvas[0],$(svgEl).html()),canvas[0].toDataURL("image/png")}},Chart.Column=function(){function Column(o){var k,v;for(k in o)v=o[k],this[k]=v;$(this.el).css("height",this.height)}return Column.prototype.isStacked=!1,Column.prototype.colorbrewer=4,Column.prototype.padding={barValue:2,axisLabels:5,barPadding:.05},Column.prototype.ticks={count:10},Column.prototype.description={triangle:{degrees:30,sideA:.5,sideB:.866025}},Column.prototype.series={},Column.prototype.render=function(){var bar,barHeight,barValueHeight,barWidth,bars,canvas,chart,color,desc,descG,descriptionTextHeight,descriptions,domain,g,grid,group,groupValue,height,index,key,labels,line,series,t,text,textWidth,tick,ty,value,values,verticalAxisLabelHeight,w,width,x,y,_i,_j,_k,_len,_len1,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,_results,_this=this;height=this.height,width=this.width,$(this.el).empty(),canvas=Mynd.select(this.el[0]).append("svg:svg").attr("class","canvas"),this.useWholeNumbers=!0,this.maxValue=-Infinity;if(this.isStacked){_ref=this.data;for(_i=0,_len=_ref.length;_i<_len;_i++){group=_ref[_i],groupValue=0,_ref1=group.data;for(key in _ref1)value=_ref1[key],parseInt(value)!==value&&(this.useWholeNumbers=!1),groupValue+=value;groupValue>this.maxValue&&(this.maxValue=groupValue)}}else{_ref2=this.data;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){group=_ref2[_j],_ref3=group.data;for(key in _ref3)value=_ref3[key],parseInt(value)!==value&&(this.useWholeNumbers=!1),value>this.maxValue&&(this.maxValue=value)}}this.axis!=null&&(labels=canvas.append("svg:g").attr("class","labels"),this.axis.horizontal!=null&&(text=labels.append("svg:text").attr("class","horizontal").attr("text-anchor","middle").attr("x",width/2).attr("y",height-this.padding.axisLabels).text(this.axis.horizontal),height=height-text.node().getBBox().height-this.padding.axisLabels,text.attr("fill",text.css("fill")),text.attr("font-size",text.css("font-size")),text.attr("font-family",text.css("font-family"))),this.axis.vertical!=null&&(text=labels.append("svg:text").attr("class","vertical").attr("text-anchor","middle").attr("x",0).attr("y",height/2).text(this.axis.vertical),verticalAxisLabelHeight=text.node().getBBox().height,text.attr("transform","rotate(-90 "+verticalAxisLabelHeight+" "+height/2+")"),width=width-verticalAxisLabelHeight-this.padding.axisLabels,text.attr("fill",text.css("fill")),text.attr("font-size",text.css("font-size")),text.attr("font-family",text.css("font-family")))),descriptions=canvas.append("svg:g").attr("class","descriptions"),this.description.maxWidth=-Infinity,this.description.totalWidth=0,descriptionTextHeight=0,_ref4=this.data;for(index in _ref4)group=_ref4[index],g=descriptions.append("svg:g").attr("class","g"+index),text=g.append("svg:text").attr("class","text").attr("text-anchor","end").text(group.description),textWidth=text.node().getComputedTextLength(),textWidth>this.description.maxWidth&&(this.description.maxWidth=textWidth),this.description.totalWidth=this.description.totalWidth+textWidth,text.attr("fill",text.css("fill")),text.attr("font-size",text.css("font-size")),text.attr("font-family",text.css("font-family")),g.append("svg:title").text(group.description),descriptionTextHeight===0&&(descriptionTextHeight=text.node().getBBox().height);height-=descriptionTextHeight,grid=canvas.append("svg:g").attr("class","grid"),domain={},domain.ticks=function(){var t,_k,_len2,_ref5,_results;_ref5=Mynd.Scale.linear().setDomain([0,_this.maxValue]).getTicks(_this.ticks.count),_results=[];for(_k=0,_len2=_ref5.length;_k<_len2;_k++)t=_ref5[_k],(parseInt(t)===t||!_this.useWholeNumbers)&&_results.push(t);return _results}(),this.ticks.maxWidth=-Infinity,_ref5=domain.ticks;for(index in _ref5)tick=_ref5[index],t=grid.append("svg:g").attr("class","t"+index),text=t.append("svg:text").attr("class","tick").attr("text-anchor","begin").attr("x",0).text(tick),textWidth=text.node().getComputedTextLength(),textWidth>this.ticks.maxWidth&&(this.ticks.maxWidth=textWidth),text.attr("fill",text.css("fill")),text.attr("font-size",text.css("font-size")),text.attr("font-family",text.css("font-family"));width-=this.ticks.maxWidth,domain.x=Mynd.Scale.ordinal().setDomain(function(){_results=[];for(var _k=0,_ref6=this.data.length;0<=_ref6?_k<_ref6:_k>_ref6;0<=_ref6?_k++:_k--)_results.push(_k);return _results}.apply(this)).setRangeBands([0,width],this.padding.barPadding),this.description.maxWidth>domain.x.getRangeBand()&&(height-=this.description.maxWidth*this.description.triangle.sideA),domain.y=Mynd.Scale.linear().setDomain([0,this.maxValue]).setRange([0,height]),domain.color=Mynd.Scale.linear().setDomain([0,this.maxValue]).setRange([0,this.colorbrewer-1],!0),_ref7=domain.ticks;for(index in _ref7)tick=_ref7[index],t=grid.select(".t"+index),line=t.append("svg:line").attr("class","line").attr("x1",this.ticks.maxWidth).attr("x2",width+this.ticks.maxWidth),line.attr("stroke",line.css("stroke")),t.attr("transform","translate(0,"+(height-domain.y(tick))+")");chart=canvas.append("svg:g").attr("class","chart"),bars=chart.append("svg:g").attr("class","bars"),values=chart.append("svg:g").attr("class","values"),_ref8=this.data;for(index in _ref8){group=_ref8[index],g=bars.append("svg:g").attr("class","g"+index),barWidth=domain.x.getRangeBand(),this.isStacked||(barWidth/=group.data.length),!this.isStacked&&group.data.length===2&&function(){var x;return x=_this.ticks.maxWidth+domain.x(index)+barWidth,line=g.append("svg:line").attr("class","line dashed").attr("style","stroke-dasharray: 10, 5;").attr("x1",x).attr("x2",x).attr("y1",0).attr("y2",height)}(),y=height,_ref9=group.data;for(series in _ref9){value=_ref9[series],barHeight=domain.y(value);if(!barHeight&&this.isStacked)continue;x=domain.x(index)+this.ticks.maxWidth,this.isStacked||(x+=series*barWidth),this.isStacked||(y=height),y-=barHeight,color=domain.color(value).toFixed(0),bar=g.append("svg:rect").attr("class","bar s"+series+" q"+color+"-"+this.colorbrewer).attr("x",x).attr("y",y).attr("width",barWidth).attr("height",barHeight),bar.attr("opacity",1),bar.attr("fill",bar.css("fill")),bar.attr("stroke",bar.css("stroke")),w=values.append("svg:g").attr("class","g"+index+" s"+series+" q"+color+"-"+this.colorbrewer),text=w.append("svg:text").attr("x",x+barWidth/2).attr("text-anchor","middle").text(value),this.isStacked?(ty=y+text.node().getBBox().height+this.padding.barValue,text.attr("y",ty),text.node().getComputedTextLength()>barWidth?text.attr("class","value on beyond"):text.attr("class","value on")):(ty=y-this.padding.barValue,barValueHeight=text.node().getBBox().height,ty<barValueHeight?(text.attr("y",ty+barValueHeight),text.node().getComputedTextLength()>barWidth?text.attr("class","value on beyond"):text.attr("class","value on")):(text.attr("y",ty),text.attr("class","value above"))),text.attr("fill",text.css("fill")),text.attr("font-size",text.css("font-size")),text.attr("font-family",text.css("font-family")),w.append("svg:title").text(value),this.onclick!=null&&function(bar,group,series,value){return bar.on("click",function(){return _this.onclick(group.description,series,value)})}(bar,group,series,value)}g.append("svg:title").text(group.description),descG=descriptions.select(".g"+index),desc=descG.select("text");if(this.description.maxWidth>barWidth){desc.attr("transform","rotate(-"+this.description.triangle.degrees+" 0 0)"),x+=barWidth;while(desc.node().getComputedTextLength()*this.description.triangle.sideB>x)desc.text(desc.text().replace("...","").split("").reverse().slice(1).reverse().join("")+"...")}else x=x+barWidth-.5*barWidth*group.data.length,desc.attr("text-anchor","middle");descG.attr("transform","translate("+x+","+(height+descriptionTextHeight)+")")}if(((_ref10=this.axis)!=null?_ref10.vertical:void 0)!=null)return labels.select(".vertical").attr("transform","rotate(-90 "+verticalAxisLabelHeight+" "+height/2+")").attr("y",height/2),grid.attr("transform","translate("+(verticalAxisLabelHeight+this.padding.axisLabels)+", 0)"),chart.attr("transform","translate("+(verticalAxisLabelHeight+this.padding.axisLabels)+", 0)"),descriptions.attr("transform","translate("+(verticalAxisLabelHeight+this.padding.axisLabels)+", 0)")},Column.prototype.hideSeries=function(series){return Mynd.select(this.el[0]).selectAll(".s"+series).attr("fill-opacity",.1)},Column.prototype.showSeries=function(series){return Mynd.select(this.el[0]).selectAll(".s"+series).attr("fill-opacity",1)},Column.prototype.toPNG=function(){return Chart.toPNG(this.el,this.width,this.height)},Column}(),Chart.Legend=function(){function Legend(o){var k,v;for(k in o)v=o[k],this[k]=v}return Legend.prototype.render=function(){var index,name,ul,_ref,_results,_this=this;$(this.el).empty(),$(this.el).append(ul=$("<ul/>")),_ref=this.series,_results=[];for(index in _ref)name=_ref[index],_results.push(function(index,name){return ul.append($("<li/>",{"class":"s"+index,html:name,click:function(e){return _this.clickAction(e.target,index)}}))}(index,name));return _results},Legend.prototype.clickAction=function(el,series){return $(el).toggleClass("disabled"),$(el).hasClass("disabled")?this.chart.hideSeries(series):this.chart.showSeries(series)},Legend}(),Chart.Settings=function(){function Settings(o){var k,v;for(k in o)v=o[k],this[k]=v}return Settings.prototype.render=function(){var stacked,_this=this;return $(this.el).empty(),stacked=$(this.el).append($("<a/>",{"class":"btn btn-mini stacked "+(this.isStacked?"active":""),text:this.isStacked?"Unstack":"Stack",click:function(e){return $(e.target).toggleClass("active"),$(e.target).hasClass("active")?(_this.chart.isStacked=!0,$(e.target).text("Unstack")):(_this.chart.isStacked=!1,$(e.target).text("Stack")),_this.legend.render(),_this.chart.render()}})),$(this.el).append($("<a/>",{"class":"btn btn-mini png",text:"Save as a PNG",click:function(e){return PlainExporter(e.target,'<img src="'+_this.chart.toPNG()+'"/>')}}))},Settings}();var Exporter,PlainExporter,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Exporter=function(){function Exporter(a,data,filename){var builder;filename==null&&(filename="widget.tsv"),this.destroy=__bind(this.destroy,this),builder=new(window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder),builder.append(data),a.attr("download",filename),(this.href=this.url.createObjectURL(builder.getBlob(""+this.mime+";charset="+this.charset)))&&a.attr("href",this.href),a.attr("data-downloadurl",[this.mime,filename,this.href].join(":"))}return Exporter.prototype.mime="text/plain",Exporter.prototype.charset="UTF-8",Exporter.prototype.url=window.webkitURL||window.URL,Exporter.prototype.destroy=function(){return this.url.revokeObjectURL(this.href)},Exporter}(),PlainExporter=function(){function PlainExporter(a,data){var w;w=window.open(),w==null||typeof w=="undefined"?a.after(this.msg=$("<span/>",{style:"margin-left:5px","class":"label label-inverse",text:"Please enable popups"})):(w.document.open(),w.document.write(data),w.document.close())}return PlainExporter.prototype.destroy=function(){var _ref;return(_ref=this.msg)!=null?_ref.fadeOut():void 0},PlainExporter}(),"bind"in Function.prototype||(Function.prototype.bind=function(owner){var args,that;return that=this,arguments.length<=1?function(){return that.apply(owner,arguments)}:(args=Array.prototype.slice.call(arguments,1),function(){return that.apply(owner,arguments.length===0?args:args.concat(Array.prototype.slice.call(arguments)))})}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(find,i){var n;i===undefined&&(i=0),i<0&&(i+=this.length),i<0&&(i=0),n=this.length;while(i<n){if(i in this&&this[i]===find)return i;i++}return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(find,i){i===undefined&&(i=this.length-1),i<0&&(i+=this.length),i>this.length-1&&(i=this.length-1),i++;while(i-->0)if(i in this&&this[i]===find)return i;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(action,that){var i,n,_results;i=0,n=this.length,_results=[];while(i<n)i in this&&action.call(that,this[i],i,this),_results.push(i++);return _results}),"map"in Array.prototype||(Array.prototype.map=function(mapper,that){var i,n,other;other=new Array(this.length),i=0,n=this.length;while(i<n)i in this&&(other[i]=mapper.call(that,this[i],i,this)),i++;return other}),"filter"in Array.prototype||(Array.prototype.filter=function(filter,that){var i,n,other,v;other=[],v=void 0,i=0,n=this.length;while(i<n)i in this&&filter.call(that,v=this[i],i,this)&&other.push(v),i++;return other}),"every"in Array.prototype||(Array.prototype.every=function(tester,that){var i,n;i=0,n=this.length;while(i<n){if(i in this&&!tester.call(that,this[i],i,this))return!1;i++}return!0}),"some"in Array.prototype||(Array.prototype.some=function(tester,that){var i,n;i=0,n=this.length;while(i<n){if(i in this&&tester.call(that,this[i],i,this))return!0;i++}return!1});var merge;merge=function(child,parent){var key;for(key in parent)child[key]==null&&Object.prototype.hasOwnProperty.call(parent,key)&&(child[key]=parent[key]);return child};var Mynd,Selection;Mynd={},Mynd.Scale={},Mynd.select=function(selector){return typeof selector=="string"?(new Selection([document])).select(selector):new Selection([[selector]])},Mynd.selectAll=function(selector){if(typeof selector=="string")return(new Selection([document])).selectAll(selector);throw new Error("Mynd.selectAll(Nodes): this function is not implemented")},Mynd.Scale.ordinal=function(){return function(){var internal,scale;return internal={},scale=function(x){if(internal.range==null)throw new Error("Mynd.Scale.ordinal: you need to set input range first");return internal.range[x]},scale.setDomain=function(domain){var d,element,key,value,_i,_len;domain==null&&(domain=[]),d={};for(_i=0,_len=domain.length;_i<_len;_i++)element=domain[_i],d[element]=element;return internal.domain=function(){var _results;_results=[];for(key in d)value=d[key],_results.push(value);return _results}(),scale},scale.setRangeBands=function(bands,padding){var range,reverse,start,step,stop,_i,_ref,_ref1,_results;padding==null&&(padding=0);if(internal.domain==null)throw new Error("Mynd.Scale.ordinal: you need to set input domain first");return start=bands[0],stop=bands[1],reverse=bands[1]<bands[0],reverse&&(_ref=[start,stop],stop=_ref[0],start=_ref[1]),step=(stop-start)/(internal.domain.length+padding),range=function(){_results=[];for(var _i=0,_ref1=internal.domain.length;0<=_ref1?_i<_ref1:_i>_ref1;0<=_ref1?_i++:_i--)_results.push(_i);return _results}.apply(this).map(function(i){return start+step*padding+step*i}),reverse&&range.reverse(),internal.range=range,internal.rangeBand=step*(1-padding),scale},scale.getRangeBand=function(){return internal.rangeBand},scale.setDomain()}()},Mynd.Scale.linear=function(){return function(){var deinterpolate,internal,interpolate,scale,scaleBilinear;return internal={},deinterpolate=function(a,b){return function(x){return(x-a)*1/(b-a)}},interpolate=function(a,b,round){return round?function(x){return Math.round(a+b*x)}:function(x){return a+b*x}},scaleBilinear=function(domain,range,round){return function(x){return interpolate(range[0],range[1],round)(deinterpolate(domain[0],domain[1])(x))}},scale=function(x){if(internal.output==null){if(internal.domain==null||internal.range==null)throw new Error("Mynd.Scale.linear: you need to set both input domain and range");internal.output=scaleBilinear(internal.domain,internal.range,internal.round)}return internal.output(x)},scale.setDomain=function(domain){return internal.domain=domain,scale},scale.setRange=function(range,round){return round==null&&(round=!1),internal.range=range,internal.round=round,scale},scale.getTicks=function(amount){var reverse,span,start,step,stop,ticks,x,_ref;if(internal.domain==null)throw new Error("Mynd.Scale.linear: you need to set input domain first");start=internal.domain[0],stop=internal.domain[1],reverse=internal.domain[1]<internal.domain[0],reverse&&(_ref=[start,stop],stop=_ref[0],start=_ref[1]),span=stop-start,step=Math.pow(10,Math.floor(Math.log(span/amount)/Math.LN10)),x=amount/span*step,x<=.15?step*=10:x<=.35?step*=5:x<=.75&&(step*=2),ticks=[],x=Math.ceil(start/step)*step;while(x<=Math.floor(stop/step)*step+step*.5)ticks.push(x),x+=step;return ticks},scale}()},Selection=function(){function Selection(elements){this.elements=elements!=null?elements:[]}return Selection.prototype.event=null,Selection.prototype.qualify=function(name){var index;return(index=name.indexOf("svg:"))?name:{space:"http://www.w3.org/2000/svg",local:name.slice(4)}},Selection.prototype.select=function(selector){var i,j,node,subgroup,subgroups,subnode,_i,_j,_ref,_ref1;typeof selector!="function"&&(selector=function(selector){return function(){return this.querySelector(selector)}}(selector)),subgroups=[];for(i=_i=0,_ref=this.elements.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){subgroups.push(subgroup=[]);for(j=_j=0,_ref1=this.elements[i].length;0<=_ref1?_j<_ref1:_j>_ref1;j=0<=_ref1?++_j:--_j)(node=this.elements[i][j])?(subgroup.push(subnode=selector.call(node,node.__data__,j)),subnode&&"__data__"in node&&(subnode.__data__=node.__data__)):subgroup.push(null)}return new Selection(subgroups)},Selection.prototype.selectAll=function(selector){var i,j,node,subgroup,subgroups,_i,_j,_ref,_ref1;subgroups=[],typeof selector!="function"&&(selector=function(selector){return function(){return this.querySelectorAll(selector)}}(selector));for(i=_i=0,_ref=this.elements.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)for(j=_j=0,_ref1=this.elements[i].length;0<=_ref1?_j<_ref1:_j>_ref1;j=0<=_ref1?++_j:--_j)(node=this.elements[i][j])&&subgroups.push(subgroup=Array.prototype.slice.call(selector.call(node,node.__data__,j)));return new Selection(subgroups)},Selection.prototype.append=function(name){return name=this.qualify(name),name.local?this.select(function(){return this.appendChild(document.createElementNS(name.space,name.local))}):this.select(function(){return this.appendChild(document.createElementNS(this.namespaceURI,name))})},Selection.prototype.each=function(callback){var i,j,node,_i,_j,_ref,_ref1;for(i=_i=0,_ref=this.elements.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)for(j=_j=0,_ref1=this.elements[i].length;0<=_ref1?_j<_ref1:_j>_ref1;j=0<=_ref1?++_j:--_j)node=this.elements[i][j],node&&callback.call(node,node.__data__,i,j);return this},Selection.prototype.attr=function(name,value){return name=this.qualify(name),this.each(function(){return value==null?name.local?function(){return this.removeAttributeNS(name.space,name.local)}:function(){return this.removeAttribute(name)}:typeof value=="function"?name.local?function(){var x;return x=value.apply(this,arguments),x==null?this.removeAttributeNS(name.space,name.local):this.setAttributeNS(name.space,name.local,x)}:function(){var x;return x=value.apply(this,arguments),x==null?this.removeAttribute(name):this.setAttribute(name,x)}:name.local?function(){return this.setAttributeNS(name.space,name.local,value)}:function(){return this.setAttribute(name,value)}}())},Selection.prototype.css=function(name){return window.getComputedStyle(this.node(),null).getPropertyValue(name)},Selection.prototype.text=function(value){return value==null?this.node().textContent:this.each(function(){return typeof value=="function"?function(){return this.textContent=value.apply(this,arguments)||""}:function(){return this.textContent=value}}())},Selection.prototype.node=function(callback){var i,j,_i,_j,_ref,_ref1;for(i=_i=0,_ref=this.elements.length;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i)for(j=_j=0,_ref1=this.elements[i].length;0<=_ref1?_j<=_ref1:_j>=_ref1;j=0<=_ref1?++_j:--_j)if(this.elements[i][j]!=null)return this.elements[i][j];return null},Selection.prototype.on=function(type,listener){var i,name;return name="__on"+type,listener==null?(i=this.node()[name])._:this.each(function(x,index){var eventListener,o,_this=this;eventListener=function(event){var bak;bak=Selection.event,Selection.event=event;try{return listener.call(_this,_this.__data__,index)}finally{Selection.event=bak}},o=this[name],o&&(this.removeEventListener(type,o,o.$),delete this[name]);if(listener)return this.addEventListener(type,this[name]=eventListener,eventListener.$=!1),eventListener._=listener})},Selection}(),intermine.mynd=Mynd;var type,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};type={},type.Root=function(){function Root(){}return Root.prototype.result=!1,Root.prototype.is=function(){return this.result},Root.prototype.toString=function(){return""+this.expected+" but got "+this.actual},Root}(),type.isString=function(_super){function isString(actual){this.actual=actual,this.result=typeof actual=="string"}return __extends(isString,_super),isString.prototype.expected="String",isString}(type.Root),type.isInteger=function(_super){function isInteger(actual){this.actual=actual,this.result=typeof actual=="number"}return __extends(isInteger,_super),isInteger.prototype.expected="Integer",isInteger}(type.Root),type.isBoolean=function(_super){function isBoolean(actual){this.actual=actual,this.result=typeof actual=="boolean"}return __extends(isBoolean,_super),isBoolean.prototype.expected="Boolean true",isBoolean}(type.Root),type.isNull=function(_super){function isNull(actual){this.actual=actual,this.result=actual===null}return __extends(isNull,_super),isNull.prototype.expected="Null",isNull}(type.Root),type.isArray=function(_super){function isArray(actual){this.actual=actual,this.result=actual instanceof Array}return __extends(isArray,_super),isArray.prototype.expected="Array",isArray}(type.Root),type.isHTTPSuccess=function(_super){function isHTTPSuccess(actual){this.actual=actual,this.result=actual===200}return __extends(isHTTPSuccess,_super),isHTTPSuccess.prototype.expected="HTTP code 200",isHTTPSuccess}(type.Root),type.isJSON=function(_super){function isJSON(actual){this.actual=actual,this.result=!0;try{typeof JSON!="undefined"&&JSON!==null&&JSON.parse(actual)}catch(e){this.result=!1}}return __extends(isJSON,_super),isJSON.prototype.expected="JSON Object",isJSON}(type.Root),type.isUndefined=function(_super){function isUndefined(){return isUndefined.__super__.constructor.apply(this,arguments)}return __extends(isUndefined,_super),isUndefined.prototype.expected="it to be undefined",isUndefined}(type.Root);var factory;factory=function(Backbone){var InterMineWidget,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};InterMineWidget=function(){function InterMineWidget(){this.error=__bind(this.error,this),this.validateType=__bind(this.validateType,this),$(this.el).html($("<div/>",{"class":"inner",style:"height:572px;overflow:hidden;position:relative"})),this.el=""+this.el+" div.inner",this.imService=new intermine.Service({root:this.service,token:this.token})}return InterMineWidget.prototype.template=function(name,context){var _name;return context==null&&(context={}),typeof JST[_name=""+name+".eco"]=="function"?JST[_name](context):void 0},InterMineWidget.prototype.validateType=function(object,spec){var fails,key,r,value;fails=[];for(key in object)value=object[key],(r=(typeof spec[key]=="function"?new spec[key](value):void 0)||(r=new type.isUndefined))&&!r.is()&&fails.push(this.template("invalidjsonkey",{key:key,actual:r.is(),expected:new String(r)}));if(fails.length)return this.error(fails,"JSONResponse")},InterMineWidget.prototype.error=function(opts,type){opts==null&&(opts={title:"Error",text:"Generic error"}),opts.name=this.name||this.id;switch(type){case"AJAXTransport":opts.title="AJAX Request Failed";break;case"JSONResponse":opts.title="Invalid JSON Response",opts.text="<ol>"+opts.join("")+"</ol>"}throw $(this.el).html(this.template("error",opts)),new Error(type)},InterMineWidget}();var ChartWidget,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ChartWidget=function(_super){function ChartWidget(service,token,id,bagName,el,widgetOptions){this.service=service,this.token=token,this.id=id,this.bagName=bagName,this.el=el,widgetOptions==null&&(widgetOptions={}),this.render=__bind(this.render,this),this.widgetOptions=merge(widgetOptions,this.widgetOptions),ChartWidget.__super__.constructor.call(this),this.render()}return __extends(ChartWidget,_super),ChartWidget.prototype.widgetOptions={title:!0,description:!0,matchCb:function(id,type){return typeof console!="undefined"&&console!==null?console.log(id,type):void 0},resultsCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0},listCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0}},ChartWidget.prototype.formOptions={},ChartWidget.prototype.spec={response:{chartType:type.isString,description:type.isString,error:type.isNull,list:type.isString,notAnalysed:type.isInteger,pathQuery:type.isString,requestedAt:type.isString,results:type.isArray,seriesLabels:type.isString,seriesValues:type.isString,statusCode:type.isHTTPSuccess,title:type.isString,type:type.isString,wasSuccessful:type.isBoolean,filters:type.isString,filterLabel:type.isString,filterSelectedValue:type.isString,simplePathQuery:type.isString,domainLabel:type.isString,rangeLabel:type.isString}},ChartWidget.prototype.render=function(){var data,key,timeout,value,_ref,_ref1,_this=this;timeout=window.setTimeout(function(){return $(_this.el).append(_this.loading=$(_this.template("loading")))},400),(_ref=this.view)!=null&&_ref.undelegateEvents(),data={widget:this.id,list:this.bagName,token:this.token},_ref1=this.formOptions;for(key in _ref1)value=_ref1[key],key!=="errorCorrection"&&key!=="pValue"&&(data.filter=value);return $.ajax({url:""+this.service+"list/chart",dataType:"jsonp",data:data,success:function(response){var _ref2;window.clearTimeout(timeout),(_ref2=_this.loading)!=null&&_ref2.remove(),_this.validateType(response,_this.spec.response);if(response.wasSuccessful)return _this.name=response.title,_this.view=new ChartView({widget:_this,el:_this.el,template:_this.template,response:response,form:{options:_this.formOptions},options:_this.widgetOptions})},error:function(request,status,error){return clearTimeout(timeout),_this.error({text:""+_this.service+"list/chart"},"AJAXTransport")}})},ChartWidget}(InterMineWidget);var EnrichmentWidget,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EnrichmentWidget=function(_super){function EnrichmentWidget(service,token,id,bagName,el,widgetOptions){this.service=service,this.token=token,this.id=id,this.bagName=bagName,this.el=el,widgetOptions==null&&(widgetOptions={}),this.render=__bind(this.render,this),this.widgetOptions=merge(widgetOptions,this.widgetOptions),this.formOptions={errorCorrection:"Holm-Bonferroni",pValue:"0.05"},EnrichmentWidget.__super__.constructor.call(this),this.render()}return __extends(EnrichmentWidget,_super),EnrichmentWidget.prototype.widgetOptions={title:!0,description:!0,matchCb:function(id,type){return typeof console!="undefined"&&console!==null?console.log(id,type):void 0},resultsCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0},listCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0}},EnrichmentWidget.prototype.errorCorrections=["Holm-Bonferroni","Benjamini Hochberg","Bonferroni","None"],EnrichmentWidget.prototype.pValues=["0.05","0.10","1.00"],EnrichmentWidget.prototype.spec={response:{title:type.isString,description:type.isString,pathQuery:type.isJSON,pathConstraint:type.isString,error:type.isNull,list:type.isString,notAnalysed:type.isInteger,requestedAt:type.isString,results:type.isArray,label:type.isString,statusCode:type.isHTTPSuccess,type:type.isString,wasSuccessful:type.isBoolean,filters:type.isString,filterLabel:type.isString,filterSelectedValue:type.isString,externalLink:type.isString,pathQueryForMatches:type.isString}},EnrichmentWidget.prototype.render=function(){var data,key,timeout,value,_ref,_ref1,_this=this;timeout=window.setTimeout(function(){return $(_this.el).append(_this.loading=$(_this.template("loading")))},400),(_ref=this.view)!=null&&_ref.undelegateEvents(),data={widget:this.id,list:this.bagName,correction:this.formOptions.errorCorrection,maxp:this.formOptions.pValue,token:this.token},_ref1=this.formOptions;for(key in _ref1)value=_ref1[key],key!=="errorCorrection"&&key!=="pValue"&&(data.filter=value);return $.ajax({url:""+this.service+"list/enrichment",dataType:"jsonp",data:data,success:function(response){var _ref2;window.clearTimeout(timeout),(_ref2=_this.loading)!=null&&_ref2.remove(),_this.validateType(response,_this.spec.response);if(response.wasSuccessful)return _this.name=response.title,_this.view=new EnrichmentView({widget:_this,el:_this.el,template:_this.template,response:response,form:{options:_this.formOptions,pValues:_this.pValues,errorCorrections:_this.errorCorrections},options:_this.widgetOptions})},error:function(request,status,error){return clearTimeout(timeout),_this.error({text:""+_this.service+"list/enrichment"},"AJAXTransport")}})},EnrichmentWidget}(InterMineWidget);var TableWidget,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};TableWidget=function(_super){function TableWidget(service,token,id,bagName,el,widgetOptions){this.service=service,this.token=token,this.id=id,this.bagName=bagName,this.el=el,widgetOptions==null&&(widgetOptions={}),this.render=__bind(this.render,this),this.widgetOptions=merge(widgetOptions,this.widgetOptions),TableWidget.__super__.constructor.call(this),this.render()}return __extends(TableWidget,_super),TableWidget.prototype.widgetOptions={title:!0,description:!0,matchCb:function(id,type){return typeof console!="undefined"&&console!==null?console.log(id,type):void 0},resultsCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0},listCb:function(pq){return typeof console!="undefined"&&console!==null?console.log(pq):void 0}},TableWidget.prototype.spec={response:{columnTitle:type.isString,title:type.isString,description:type.isString,pathQuery:type.isString,columns:type.isString,pathConstraint:type.isString,requestedAt:type.isString,list:type.isString,type:type.isString,notAnalysed:type.isInteger,results:type.isArray,wasSuccessful:type.isBoolean,error:type.isNull,statusCode:type.isHTTPSuccess}},TableWidget.prototype.render=function(){var data,timeout,_ref,_this=this;return timeout=window.setTimeout(function(){return $(_this.el).append(_this.loading=$(_this.template("loading")))},400),(_ref=this.view)!=null&&_ref.undelegateEvents(),data={widget:this.id,list:this.bagName,token:this.token},$.ajax({url:""+this.service+"list/table",dataType:"jsonp",data:data,success:function(response){var _ref1;window.clearTimeout(timeout),(_ref1=_this.loading)!=null&&_ref1.remove(),_this.validateType(response,_this.spec.response);if(response.wasSuccessful)return _this.name=response.title,_this.view=new TableView({widget:_this,el:_this.el,template:_this.template,response:response,options:_this.widgetOptions})},error:function(request,status,error){return clearTimeout(timeout),_this.error({text:""+_this.service+"list/table"},"AJAXTransport")}})},TableWidget}(InterMineWidget);var CoreCollection,CoreModel,EnrichmentResults,EnrichmentRow,TableResults,TableRow,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};CoreModel=function(_super){function CoreModel(){return this.toggleSelected=__bind(this.toggleSelected,this),this.validate=__bind(this.validate,this),CoreModel.__super__.constructor.apply(this,arguments)}return __extends(CoreModel,_super),CoreModel.prototype.defaults={selected:!1},CoreModel.prototype.initialize=function(row,widget){return this.widget=widget,this.validate(row)},CoreModel.prototype.validate=function(row){return this.widget.validateType(row,this.spec)},CoreModel.prototype.toggleSelected=function(){return this.set({selected:!this.get("selected")})},CoreModel}(Backbone.Model),CoreCollection=function(_super){function CoreCollection(){return CoreCollection.__super__.constructor.apply(this,arguments)}return __extends(CoreCollection,_super),CoreCollection.prototype.model=CoreModel,CoreCollection.prototype.selected=function(){return this.filter(function(row){return row.get("selected")})},CoreCollection.prototype.toggleSelected=function(){var model,_i,_j,_len,_len1,_ref,_ref1,_results,_results1;if(this.models.length-this.selected().length){_ref=this.models,_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],_results.push(model.set({selected:!0},{silent:!0}));return _results}_ref1=this.models,_results1=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++)model=_ref1[_j],_results1.push(model.set({selected:!1},{silent:!0}));return _results1},CoreCollection}(Backbone.Collection),EnrichmentRow=function(_super){function EnrichmentRow(){return EnrichmentRow.__super__.constructor.apply(this,arguments)}return __extends(EnrichmentRow,_super),EnrichmentRow.prototype.spec={description:type.isString,identifier:type.isString,matches:type.isInteger,"p-value":type.isInteger,selected:type.isBoolean,externalLink:type.isString},EnrichmentRow}(CoreModel),EnrichmentResults=function(_super){function EnrichmentResults(){return EnrichmentResults.__super__.constructor.apply(this,arguments)}return __extends(EnrichmentResults,_super),EnrichmentResults.prototype.model=EnrichmentRow,EnrichmentResults}(CoreCollection),TableRow=function(_super){function TableRow(){return TableRow.__super__.constructor.apply(this,arguments)}return __extends(TableRow,_super),TableRow.prototype.spec={matches:type.isInteger,identifier:type.isInteger,descriptions:type.isArray,selected:type.isBoolean},TableRow}(CoreModel),TableResults=function(_super){function TableResults(){return TableResults.__super__.constructor.apply(this,arguments)}return __extends(TableResults,_super),TableResults.prototype.model=TableRow,TableResults}(CoreCollection);var ChartPopoverView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ChartPopoverView=function(_super){function ChartPopoverView(){return this.close=__bind(this.close,this),this.listAction=__bind(this.listAction,this),this.resultsAction=__bind(this.resultsAction,this),this.matchAction=__bind(this.matchAction,this),this.renderValues=__bind(this.renderValues,this),this.render=__bind(this.render,this),ChartPopoverView.__super__.constructor.apply(this,arguments)}return __extends(ChartPopoverView,_super),ChartPopoverView.prototype.descriptionLimit=50,ChartPopoverView.prototype.valuesLimit=5,ChartPopoverView.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"close"},ChartPopoverView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.render()},ChartPopoverView.prototype.render=function(){var values,_this=this;return $(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:"width:300px"})),values=[],this.imService.query(this.quickPq,function(q){return q.rows(function(response){var object,_i,_len;for(_i=0,_len=response.length;_i<_len;_i++)object=response[_i],values.push(function(object){var column,_j,_len1;for(_j=0,_len1=object.length;_j<_len1;_j++){column=object[_j];if(column.length>0)return column}}(object));return _this.renderValues(values)})}),this},ChartPopoverView.prototype.renderValues=function(values){return $(this.el).find("div.values").html(this.template("popover.values",{values:values,type:this.type,valuesLimit:this.valuesLimit}))},ChartPopoverView.prototype.matchAction=function(e){return this.matchCb($(e.target).text(),this.type),e.preventDefault()},ChartPopoverView.prototype.resultsAction=function(){return this.resultsCb(this.resultsPq)},ChartPopoverView.prototype.listAction=function(){return this.listCb(this.resultsPq)},ChartPopoverView.prototype.close=function(){return $(this.el).remove()},ChartPopoverView}(Backbone.View);var ChartView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ChartView=function(_super){function ChartView(){return this.formAction=__bind(this.formAction,this),this.barAction=__bind(this.barAction,this),ChartView.__super__.constructor.apply(this,arguments)}return __extends(ChartView,_super),ChartView.prototype.events={"change div.form select":"formAction"},ChartView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.render()},ChartView.prototype.render=function(){var chart,data,legend,settings,v,_i,_len,_ref;$(this.el).html(this.template("chart",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),this.response.filterLabel!=null&&$(this.el).find("div.form form").append(this.template("extra",{label:this.response.filterLabel,possible:this.response.filters.split(","),selected:this.response.filterSelectedValue}));if(this.response.results.length>1){data=[],_ref=this.response.results.slice(1);for(_i=0,_len=_ref.length;_i<_len;_i++)v=_ref[_i],data.push({description:v[0],data:[v[1],v[2]]});return chart=new Chart.Column({el:$(this.el).find("div.content div.chart"),data:data,width:460,onclick:this.barAction,isStacked:this.response.chartType==="BarChart",axis:{horizontal:this.response.domainLabel,vertical:this.response.type+" Count"}}),legend=new Chart.Legend({el:$(this.el).find("div.content div.legend"),chart:chart,series:[this.response.results[0][1],this.response.results[0][2]]}),legend.render(),settings=new Chart.Settings({el:$(this.el).find("div.content div.settings"),chart:chart,legend:legend,isStacked:this.response.chartType==="BarChart"}),settings.render(),chart.height=$(this.widget.el).height()-$(this.widget.el).find("div.header").height()-$(this.widget.el).find("div.content div.legend").height()-$(this.widget.el).find("div.content div.settings").height(),chart.render()}return $(this.el).find("div.content").html($(this.template("noresults")))},ChartView.prototype.barAction=function(category,seriesIndex,value){var description,quickPq,resultsPq,series,_ref;description="",resultsPq=this.response.pathQuery,quickPq=this.response.simplePathQuery,description+=category,resultsPq=resultsPq.replace("%category",category),quickPq=quickPq.replace("%category",category),description+=" "+this.response.seriesLabels.split(",")[seriesIndex],series=(_ref=this.response.seriesValues)!=null?_ref.split(",")[seriesIndex]:void 0,resultsPq=resultsPq.replace("%series",series),quickPq=resultsPq.replace("%series",series),resultsPq=typeof JSON!="undefined"&&JSON!==null?JSON.parse(resultsPq):void 0,quickPq=typeof JSON!="undefined"&&JSON!==null?JSON.parse(quickPq):void 0,this.barView!=null&&this.barView.close();if(description)return $(this.el).find("div.content").append((this.barView=new ChartPopoverView({description:description,template:this.template,resultsPq:resultsPq,resultsCb:this.options.resultsCb,listCb:this.options.listCb,matchCb:this.options.matchCb,quickPq:quickPq,imService:this.widget.imService,type:this.response.type})).el)},ChartView.prototype.formAction=function(e){return this.widget.formOptions[$(e.target).attr("name")]=$(e.target[e.target.selectedIndex]).attr("value"),this.widget.render()},ChartView}(Backbone.View);var EnrichmentPopoverView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};EnrichmentPopoverView=function(_super){function EnrichmentPopoverView(){return this.listAction=__bind(this.listAction,this),this.resultsAction=__bind(this.resultsAction,this),this.matchAction=__bind(this.matchAction,this),this.getPq=__bind(this.getPq,this),this.toggle=__bind(this.toggle,this),this.renderValues=__bind(this.renderValues,this),this.render=__bind(this.render,this),EnrichmentPopoverView.__super__.constructor.apply(this,arguments)}return __extends(EnrichmentPopoverView,_super),EnrichmentPopoverView.prototype.descriptionLimit=50,EnrichmentPopoverView.prototype.valuesLimit=5,EnrichmentPopoverView.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"toggle"},EnrichmentPopoverView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.render()},EnrichmentPopoverView.prototype.render=function(){var pq,values,_this=this;return $(this.el).css({position:"relative"}),$(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:this.style||"width:300px;margin-left:-300px"})),pq=typeof JSON!="undefined"&&JSON!==null?JSON.parse(this.response.pathQueryForMatches):void 0,pq.where.push({path:this.response.pathConstraint,op:"ONE OF",values:this.identifiers}),values=[],this.imService.query(pq,function(q){return q.rows(function(response){var object,value,_i,_len;for(_i=0,_len=response.length;_i<_len;_i++)object=response[_i],value=function(object){var column,_j,_len1,_ref;_ref=object.reverse();for(_j=0,_len1=_ref.length;_j<_len1;_j++){column=_ref[_j];if(column.length>0)return column}}(object),__indexOf.call(values,value)<0&&values.push(value);return _this.renderValues(values)})}),this},EnrichmentPopoverView.prototype.renderValues=function(values){return $(this.el).find("div.values").html(this.template("popover.values",{values:values,type:this.response.type,valuesLimit:this.valuesLimit}))},EnrichmentPopoverView.prototype.toggle=function(){return $(this.el).toggle()},EnrichmentPopoverView.prototype.getPq=function(){var pq;return pq=this.response.pathQuery,this.pq=JSON.parse(pq),this.pq.where.push({path:this.response.pathConstraint,op:"ONE OF",values:this.identifiers})},EnrichmentPopoverView.prototype.matchAction=function(e){return this.matchCb($(e.target).text(),this.response.type),e.preventDefault()},EnrichmentPopoverView.prototype.resultsAction=function(){return this.pq==null&&this.getPq(),this.resultsCb(this.pq)},EnrichmentPopoverView.prototype.listAction=function(){return this.pq==null&&this.getPq(),this.listCb(this.pq)},EnrichmentPopoverView}(Backbone.View);var EnrichmentRowView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EnrichmentRowView=function(_super){function EnrichmentRowView(){return this.toggleMatchesAction=__bind(this.toggleMatchesAction,this),this.selectAction=__bind(this.selectAction,this),this.render=__bind(this.render,this),EnrichmentRowView.__super__.constructor.apply(this,arguments)}return __extends(EnrichmentRowView,_super),EnrichmentRowView.prototype.tagName="tr",EnrichmentRowView.prototype.events={"click td.check input":"selectAction","click td.matches a.count":"toggleMatchesAction"},EnrichmentRowView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.model.bind("change",this.render),this.render()},EnrichmentRowView.prototype.render=function(){return $(this.el).html(this.template("enrichment.row",{row:this.model.toJSON()})),this},EnrichmentRowView.prototype.selectAction=function(){return this.model.toggleSelected()},EnrichmentRowView.prototype.toggleMatchesAction=function(){return this.popoverView==null?$(this.el).find("td.matches a.count").after((this.popoverView=new EnrichmentPopoverView({matches:this.model.get("matches"),identifiers:[this.model.get("identifier")],description:this.model.get("description"),template:this.template,matchCb:this.callbacks.matchCb,resultsCb:this.callbacks.resultsCb,listCb:this.callbacks.listCb,response:this.response,imService:this.imService})).el):this.popoverView.toggle()},EnrichmentRowView}(Backbone.View);var EnrichmentView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EnrichmentView=function(_super){function EnrichmentView(){return this.viewAction=__bind(this.viewAction,this),this.exportAction=__bind(this.exportAction,this),this.selectAllAction=__bind(this.selectAllAction,this),this.formAction=__bind(this.formAction,this),this.renderTableBody=__bind(this.renderTableBody,this),this.renderTable=__bind(this.renderTable,this),this.renderToolbar=__bind(this.renderToolbar,this),EnrichmentView.__super__.constructor.apply(this,arguments)}return __extends(EnrichmentView,_super),EnrichmentView.prototype.events={"click div.actions a.view":"viewAction","click div.actions a.export":"exportAction","change div.form select":"formAction","click div.content input.check":"selectAllAction"},EnrichmentView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.collection=new EnrichmentResults,this.collection.bind("change",this.renderToolbar),this.render()},EnrichmentView.prototype.render=function(){return $(this.el).html(this.template("enrichment",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),$(this.el).find("div.form").html(this.template("enrichment.form",{options:this.form.options,pValues:this.form.pValues,errorCorrections:this.form.errorCorrections})),this.response.filterLabel!=null&&$(this.el).find("div.form form").append(this.template("extra",{label:this.response.filterLabel,possible:this.response.filters.split(","),selected:this.response.filterSelectedValue})),this.response.results.length>0?(this.renderToolbar(),this.renderTable()):$(this.el).find("div.content").html($(this.template("noresults"))),this},EnrichmentView.prototype.renderToolbar=function(){return $(this.el).find("div.actions").html($(this.template("actions",{disabled:this.collection.selected().length===0})))},EnrichmentView.prototype.renderTable=function(){var height,i,table,_fn,_i,_ref,_this=this;$(this.el).find("div.content").html($(this.template("enrichment.table",{label:this.response.label}))),table=$(this.el).find("div.content table"),_fn=function(i){var data,row;return data=_this.response.results[i],_this.response.externalLink&&(data.externalLink=_this.response.externalLink+data.identifier),row=new EnrichmentRow(data,_this.widget),_this.collection.add(row)};for(i=_i=0,_ref=this.response.results.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)_fn(i);return this.renderTableBody(table),height=$(this.el).height()-$(this.el).find("div.header").height()-$(this.el).find("div.content div.head").height(),$(this.el).find("div.content div.wrapper").css("height",""+height+"px"),$(this.el).find("div.content div.head").css("width",$(this.el).find("div.content table").width()+"px"),table.find("thead th").each(function(i,th){return $(_this.el).find("div.content div.head div:eq("+i+")").width($(th).width())}),table.css({"margin-top":"-"+table.find("thead").height()+"px"})},EnrichmentView.prototype.renderTableBody=function(table){var fragment,row,_i,_len,_ref;fragment=document.createDocumentFragment(),_ref=this.collection.models;for(_i=0,_len=_ref.length;_i<_len;_i++)row=_ref[_i],fragment.appendChild((new EnrichmentRowView({model:row,template:this.template,type:this.response.type,callbacks:{matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb},response:this.response,imService:this.widget.imService})).el);return table.find("tbody").html(fragment)},EnrichmentView.prototype.formAction=function(e){return this.widget.formOptions[$(e.target).attr("name")]=$(e.target[e.target.selectedIndex]).attr("value"),this.widget.render()},EnrichmentView.prototype.selectAllAction=function(){return this.collection.toggleSelected(),this.renderToolbar(),this.renderTableBody($(this.el).find("div.content table"))},EnrichmentView.prototype.exportAction=function(e){var model,pq,rowIdentifiers,_i,_len,_ref,_this=this;rowIdentifiers=[],_ref=this.collection.selected();for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],rowIdentifiers.push(model.get("identifier"));return pq=typeof JSON!="undefined"&&JSON!==null?JSON.parse(this.response.pathQueryForMatches):void 0,pq.where.push({path:this.response.pathConstraint,op:"ONE OF",values:rowIdentifiers}),this.widget.imService.query(pq,function(q){return q.rows(function(response){var dict,ex,object,result,_j,_k,_len1,_len2,_ref1;dict={};for(_j=0,_len1=response.length;_j<_len1;_j++)object=response[_j],dict[object[0]]==null&&(dict[object[0]]=[]),dict[object[0]].push(object[1]);result=[],_ref1=_this.collection.selected();for(_k=0,_len2=_ref1.length;_k<_len2;_k++)model=_ref1[_k],result.push([model.get("description"),model.get("p-value")].join("	")+"	"+dict[model.get("identifier")].join(","));if(result.length)return ex=new PlainExporter($(e.target),"<pre>"+result.join("\n")+"<pre>"),window.setTimeout(function(){return ex.destroy()},5e3)})})},EnrichmentView.prototype.viewAction=function(){var descriptions,model,rowIdentifiers,_i,_len,_ref,_ref1;descriptions=[],rowIdentifiers=[],_ref=this.collection.selected();for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],descriptions.push(model.get("description")),rowIdentifiers.push(model.get("identifier"));if(rowIdentifiers.length)return(_ref1=this.popoverView)!=null&&_ref1.remove(),$(this.el).find("div.actions").after((this.popoverView=new EnrichmentPopoverView({identifiers:rowIdentifiers,description:descriptions.join(", "),template:this.template,style:"width:300px",matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb,response:this.response,imService:this.widget.imService})).el)},EnrichmentView}(Backbone.View);var TablePopoverView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};TablePopoverView=function(_super){function TablePopoverView(){return this.close=__bind(this.close,this),this.listAction=__bind(this.listAction,this),this.resultsAction=__bind(this.resultsAction,this),this.matchAction=__bind(this.matchAction,this),this.renderValues=__bind(this.renderValues,this),this.render=__bind(this.render,this),TablePopoverView.__super__.constructor.apply(this,arguments)}return __extends(TablePopoverView,_super),TablePopoverView.prototype.descriptionLimit=50,TablePopoverView.prototype.valuesLimit=5,TablePopoverView.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"close"},TablePopoverView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.render()},TablePopoverView.prototype.render=function(){var values,_this=this;return $(this.el).css({position:"relative"}),$(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:"width:300px"})),this.pathQuery=JSON.parse(this.pathQuery),this.pathQuery.where.push({path:this.pathConstraint,op:"ONE OF",values:this.identifiers}),values=[],this.imService.query(this.pathQuery,function(q){return q.rows(function(response){var object,_i,_len;for(_i=0,_len=response.length;_i<_len;_i++)object=response[_i],values.push(function(object){var column,_j,_len1;for(_j=0,_len1=object.length;_j<_len1;_j++){column=object[_j];if(column.length>0)return column}}(object));return _this.renderValues(values)})}),this},TablePopoverView.prototype.renderValues=function(values){return $(this.el).find("div.values").html(this.template("popover.values",{values:values,type:this.type,valuesLimit:this.valuesLimit}))},TablePopoverView.prototype.matchAction=function(e){return this.matchCb($(e.target).text(),this.type),e.preventDefault()},TablePopoverView.prototype.resultsAction=function(){return this.resultsCb(this.pathQuery)},TablePopoverView.prototype.listAction=function(){return this.listCb(this.pathQuery)},TablePopoverView.prototype.close=function(){return $(this.el).remove()},TablePopoverView}(Backbone.View);var TableRowView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};TableRowView=function(_super){function TableRowView(){return this.selectAction=__bind(this.selectAction,this),this.render=__bind(this.render,this),TableRowView.__super__.constructor.apply(this,arguments)}return __extends(TableRowView,_super),TableRowView.prototype.tagName="tr",TableRowView.prototype.events={"click td.check input":"selectAction"},TableRowView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.model.bind("change",this.render),this.render()},TableRowView.prototype.render=function(){return $(this.el).html(this.template("table.row",{row:this.model.toJSON()})),this},TableRowView.prototype.selectAction=function(){return this.model.toggleSelected()},TableRowView}(Backbone.View);var TableView,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};return TableView=function(_super){function TableView(){return this.viewAction=__bind(this.viewAction,this),this.exportAction=__bind(this.exportAction,this),this.selectAllAction=__bind(this.selectAllAction,this),this.renderTableBody=__bind(this.renderTableBody,this),this.renderTable=__bind(this.renderTable,this),this.renderToolbar=__bind(this.renderToolbar,this),TableView.__super__.constructor.apply(this,arguments)}return __extends(TableView,_super),TableView.prototype.events={"click div.actions a.view":"viewAction","click div.actions a.export":"exportAction","click div.content input.check":"selectAllAction"},TableView.prototype.initialize=function(o){var k,v;for(k in o)v=o[k],this[k]=v;return this.collection=new TableResults,this.collection.bind("change",this.renderToolbar),this.render()},TableView.prototype.render=function(){return $(this.el).html(this.template("table",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),this.response.results.length>0?(this.renderToolbar(),this.renderTable()):$(this.el).find("div.content").html($(this.template("noresults"))),this},TableView.prototype.renderToolbar=function(){return $(this.el).find("div.actions").html($(this.template("actions",{disabled:this.collection.selected().length===0})))},TableView.prototype.renderTable=function(){var height,i,table,_fn,_i,_ref,_this=this;$(this.el).find("div.content").html($(this.template("table.table",{columns:this.response.columns.split(",")}))),table=$(this.el).find("div.content table"),_fn=function(i){var row;return row=new TableRow(_this.response.results[i],_this.widget),_this.collection.add(row)};for(i=_i=0,_ref=this.response.results.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)_fn(i);return this.renderTableBody(table),height=$(this.el).height()-$(this.el).find("div.header").height()-$(this.el).find("div.content div.head").height(),$(this.el).find("div.content div.wrapper").css("height",""+height+"px"),$(this.el).find("div.content div.head").css("width",$(this.el).find("div.content table").width()+"px"),table.find("thead th").each(function(i,th){return $(_this.el).find("div.content div.head div:eq("+i+")").width($(th).width())}),table.css({"margin-top":"-"+table.find("thead").height()+"px"})},TableView.prototype.renderTableBody=function(table){var fragment,row,_i,_len,_ref;fragment=document.createDocumentFragment(),_ref=this.collection.models;for(_i=0,_len=_ref.length;_i<_len;_i++)row=_ref[_i],fragment.appendChild((new TableRowView({model:row,template:this.template,response:this.response})).el);return table.find("tbody").html(fragment)},TableView.prototype.selectAllAction=function(){return this.collection.toggleSelected(),this.renderToolbar(),this.renderTableBody($(this.el).find("div.content table"))},TableView.prototype.exportAction=function(e){var ex,model,result,_i,_len,_ref;result=[this.response.columns.replace(/,/g,"	")],_ref=this.collection.selected();for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],result.push(model.get("descriptions").join("	")+"	"+model.get("matches"));if(result.length)return ex=new PlainExporter($(e.target),"<pre>"+result.join("\n")+"<pre>"),window.setTimeout(function(){return ex.destroy()},5e3)},TableView.prototype.viewAction=function(){var descriptions,model,rowIdentifiers,_i,_len,_ref,_ref1;descriptions=[],rowIdentifiers=[],_ref=this.collection.selected();for(_i=0,_len=_ref.length;_i<_len;_i++)model=_ref[_i],descriptions.push(model.get("descriptions")[0]),rowIdentifiers.push(model.get("identifier"));if(rowIdentifiers.length)return(_ref1=this.popoverView)!=null&&_ref1.remove(),$(this.el).find("div.actions").after((this.popoverView=new TablePopoverView({identifiers:rowIdentifiers,description:descriptions.join(", "),template:this.template,matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb,pathQuery:this.response.pathQuery,pathConstraint:this.response.pathConstraint,imService:this.widget.imService,type:this.response.type})).el)},TableView}(Backbone.View),{ChartWidget:ChartWidget,EnrichmentWidget:EnrichmentWidget,InterMineWidget:InterMineWidget,TableWidget:TableWidget,CoreModel:CoreModel,ChartPopoverView:ChartPopoverView,ChartView:ChartView,EnrichmentPopoverView:EnrichmentPopoverView,EnrichmentRowView:EnrichmentRowView,EnrichmentView:EnrichmentView,TablePopoverView:TablePopoverView,TableRowView:TableRowView,TableView:TableView}};var $,Widgets,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};$=window.jQuery||window.Zepto,Widgets=function(){function Widgets(service,token){var _this=this;this.service=service,this.token=token!=null?token:"",this.all=__bind(this.all,this),this.table=__bind(this.table,this),this.enrichment=__bind(this.enrichment,this),this.chart=__bind(this.chart,this),intermine.load(this.resources,function(){return $=window.jQuery,__extends(o,factory(window.Backbone)),_this.wait=!1})}return Widgets.prototype.VERSION="d3",Widgets.prototype.wait=!0,Widgets.prototype.resources=[{name:"JSON",path:"http://cdn.intermine.org/js/json3/3.2.2/json3.min.js",type:"js"},{name:"jQuery",path:"http://cdn.intermine.org/js/jquery/1.7.2/jquery.min.js",type:"js",wait:!0},{name:"_",path:"http://cdn.intermine.org/js/underscore.js/1.3.3/underscore-min.js",type:"js",wait:!0},{name:"Backbone",path:"http://cdn.intermine.org/js/backbone.js/0.9.2/backbone-min.js",type:"js",wait:!0},{path:"http://cdn.intermine.org/js/intermine/imjs/latest/imjs.js",type:"js"},{path:"http://cdn.intermine.org/js/canvg/latest/rgbcolor.js",type:"js"},{path:"http://cdn.intermine.org/js/canvg/latest/canvg.js",type:"js"}],Widgets.prototype.chart=function(){var opts,_this=this;return opts=1<=arguments.length?__slice.call(arguments,0):[],this.wait?window.setTimeout(function(){return _this.chart.apply(_this,opts)},0):function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args),t=typeof result;return t=="object"||t=="function"?result||child:child}(o.ChartWidget,[this.service,this.token].concat(__slice.call(opts)),function(){})},Widgets.prototype.enrichment=function(){var opts,_this=this;return opts=1<=arguments.length?__slice.call(arguments,0):[],this.wait?window.setTimeout(function(){return _this.enrichment.apply(_this,opts)},0):function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args),t=typeof result;return t=="object"||t=="function"?result||child:child}(o.EnrichmentWidget,[this.service,this.token].concat(__slice.call(opts)),function(){})},Widgets.prototype.table=function(){var opts,_this=this;return opts=1<=arguments.length?__slice.call(arguments,0):[],this.wait?window.setTimeout(function(){return _this.table.apply(_this,opts)},0):function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args),t=typeof result;return t=="object"||t=="function"?result||child:child}(o.TableWidget,[this.service,this.token].concat(__slice.call(opts)),function(){})},Widgets.prototype.all=function(type,bagName,el,widgetOptions){var _this=this;return type==null&&(type="Gene"),this.wait?window.setTimeout(function(){return _this.all(type,bagName,el,widgetOptions)},0):$.ajax({url:""+this.service+"widgets",dataType:"jsonp",success:function(response){var widget,widgetEl,_i,_len,_ref,_results;if(response.widgets){_ref=response.widgets,_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){widget=_ref[_i];if(!(__indexOf.call(widget.targets,type)>=0))continue;widgetEl=widget.name.replace(/[^-a-zA-Z0-9,&\s]+/ig,"").replace(/-/gi,"_").replace(/\s/gi,"-").toLowerCase(),$(el).append($("<div/>",{id:widgetEl,"class":"widget span6"}));switch(widget.widgetType){case"chart":_results.push(_this.chart(widget.name,bagName,""+el+" #"+widgetEl,widgetOptions));break;case"enrichment":_results.push(_this.enrichment(widget.name,bagName,""+el+" #"+widgetEl,widgetOptions));break;case"table":_results.push(_this.table(widget.name,bagName,""+el+" #"+widgetEl,widgetOptions));break;default:_results.push(void 0)}}return _results}},error:function(xhr,opts,err){return $(el).html($("<div/>",{"class":"alert alert-error",html:""+xhr.statusText+" for <a href='"+_this.service+"widgets'>"+_this.service+"widgets</a>"}))}})},Widgets}();if(!window.intermine)throw"You need to include the InterMine API Loader first!";window.intermine.widgets=Widgets}).call(this)